<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=7.4.1">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg?v=7.4.1" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.1">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Sans:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.4.1',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'å¤åˆ¶',
      copy_success: 'å¤åˆ¶æˆåŠŸ',
      copy_failure: 'å¤åˆ¶å¤±è´¥'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="ä¹‹å‰å·²ç»å†™äº†ä¸€ç¯‡å®‰è£… R-CNN çš„æ–‡ç« äº†ï¼Œç°åœ¨å°±è¦ä½¿ç”¨è‡ªå·±çš„æ•°æ®é›†è®­ç»ƒ R-CNN äº†ã€‚ è¿™ç¯‡æ–‡ç« è®°å½•äº†æˆ‘ç”¨äººè„¸æ•°æ®é›†æ¥è®­ç»ƒ R-CNNï¼Œå¹¶ä¸”ä½¿ç”¨è®­ç»ƒåçš„ R-CNN æ¨¡å‹æ£€æµ‹å‡ºå›¾ç‰‡ä¸­çš„äººè„¸çš„è¿‡ç¨‹ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="ä½¿ç”¨è‡ªå·±çš„æ•°æ®é›†è®­ç»ƒ R-CNN">
<meta property="og:url" content="https://code.zackzhang.net/post/training-rcnn-using-my-own-dataset.html">
<meta property="og:site_name" content="å…¨æ°æ˜¯ä¹Ÿ">
<meta property="og:description" content="ä¹‹å‰å·²ç»å†™äº†ä¸€ç¯‡å®‰è£… R-CNN çš„æ–‡ç« äº†ï¼Œç°åœ¨å°±è¦ä½¿ç”¨è‡ªå·±çš„æ•°æ®é›†è®­ç»ƒ R-CNN äº†ã€‚ è¿™ç¯‡æ–‡ç« è®°å½•äº†æˆ‘ç”¨äººè„¸æ•°æ®é›†æ¥è®­ç»ƒ R-CNNï¼Œå¹¶ä¸”ä½¿ç”¨è®­ç»ƒåçš„ R-CNN æ¨¡å‹æ£€æµ‹å‡ºå›¾ç‰‡ä¸­çš„äººè„¸çš„è¿‡ç¨‹ã€‚">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1771371-f0091bb3f2535c8f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1771371-efb95ccbb5a61169.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1771371-0a82b1612b42f11c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1771371-ccd1f6cffac4bfbb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1771371-2abe97c3547a344a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1771371-0a465ddf4df729e8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1771371-b7c47dabf973c30a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1771371-710539bed53db8d4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1771371-2fa6c4b2e0f244bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1771371-516e91f945b4f959.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2019-10-17T05:07:55.914Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ä½¿ç”¨è‡ªå·±çš„æ•°æ®é›†è®­ç»ƒ R-CNN">
<meta name="twitter:description" content="ä¹‹å‰å·²ç»å†™äº†ä¸€ç¯‡å®‰è£… R-CNN çš„æ–‡ç« äº†ï¼Œç°åœ¨å°±è¦ä½¿ç”¨è‡ªå·±çš„æ•°æ®é›†è®­ç»ƒ R-CNN äº†ã€‚ è¿™ç¯‡æ–‡ç« è®°å½•äº†æˆ‘ç”¨äººè„¸æ•°æ®é›†æ¥è®­ç»ƒ R-CNNï¼Œå¹¶ä¸”ä½¿ç”¨è®­ç»ƒåçš„ R-CNN æ¨¡å‹æ£€æµ‹å‡ºå›¾ç‰‡ä¸­çš„äººè„¸çš„è¿‡ç¨‹ã€‚">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/1771371-f0091bb3f2535c8f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
  <link rel="canonical" href="https://code.zackzhang.net/post/training-rcnn-using-my-own-dataset">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>ä½¿ç”¨è‡ªå·±çš„æ•°æ®é›†è®­ç»ƒ R-CNN | å…¨æ°æ˜¯ä¹Ÿ</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">å…¨æ°æ˜¯ä¹Ÿ</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">è§è¯</p>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
        
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>é¦–é¡µ</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>å½’æ¡£</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>å…³äº</a>

  </li>
      
    
  </ul>

    

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://code.zackzhang.net/post/training-rcnn-using-my-own-dataset.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="å…¨æ°æ˜¯ä¹Ÿ">
      <meta itemprop="description" content="è§è¯">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å…¨æ°æ˜¯ä¹Ÿ">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            ä½¿ç”¨è‡ªå·±çš„æ•°æ®é›†è®­ç»ƒ R-CNN
            

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-04-01 00:00:00" itemprop="dateCreated datePublished" datetime="2017-04-01T00:00:00+08:00">2017-04-01</time>
            </span>
          

          
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              
              <span>13 åˆ†é’Ÿ</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>ä¹‹å‰å·²ç»å†™äº†ä¸€ç¯‡å®‰è£… R-CNN çš„<a href="https://code.zackzhang.net/post/rcnn-installation-memo.html">æ–‡ç« </a>äº†ï¼Œç°åœ¨å°±è¦ä½¿ç”¨è‡ªå·±çš„æ•°æ®é›†è®­ç»ƒ R-CNN äº†ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« è®°å½•äº†æˆ‘ç”¨äººè„¸æ•°æ®é›†æ¥è®­ç»ƒ R-CNNï¼Œå¹¶ä¸”ä½¿ç”¨è®­ç»ƒåçš„ R-CNN æ¨¡å‹æ£€æµ‹å‡ºå›¾ç‰‡ä¸­çš„äººè„¸çš„è¿‡ç¨‹ã€‚</p>
<a id="more"></a>
<div class="note warning">
            <div style="color: #f0ad4e; font-size: 1.3em; font-weight: bold">âš ï¸ æ³¨æ„</div><p>è™½ç„¶ä¸‹è¿°å†…å®¹åœ¨æˆ‘çš„ç”µè„‘ä¸Šæµ‹è¯•é€šè¿‡ï¼Œä½†æ˜¯ç”±äºæ­¤æ–‡ç« æ˜¯æˆ‘åœ¨åšæ¯•ä¸šè®¾è®¡æœŸé—´æ’°å†™çš„ï¼Œæ—¶é—´ç´§è¿«ï¼Œæœªèƒ½è€ƒè™‘åˆ°æ‰€æœ‰æƒ…å†µï¼Œä»…æ˜¯åšè®°å½•ä½¿ç”¨ï¼Œå› æ­¤ä¸‹è¿°å†…å®¹ä¸ä¸€å®šé€‚ç”¨äºæ¯ä¸ªäººï¼Œå¦‚æœå‘ç°é”™è¯¯ï¼Œè¯·æ±‚åŠ©äºå…¶ä»–åšå®¢ï¼Œæ•¬è¯·ç•™æ„ï¼</p>
          </div>
<h1 id="æ„å»ºæ•°æ®é›†"><a href="#æ„å»ºæ•°æ®é›†" class="headerlink" title="æ„å»ºæ•°æ®é›†"></a>æ„å»ºæ•°æ®é›†</h1><p>æŸ¥çœ‹ R-CNN çš„ demo ç¨‹åºçš„æºä»£ç  <code>rcnn_demo.m</code> å‘ç°ï¼Œæœ‰ä¸¤ä¸ªå·²ç»è®­ç»ƒå¥½çš„æ¨¡å‹å¯ä¾›ä½¿ç”¨ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ä½¿ç”¨ <a href="http://host.robots.ox.ac.uk/pascal/VOC/voc2007/index.html" target="_blank" rel="noopener">PASCAL VOC 2007</a> æ•°æ®é›†å’Œ <a href="http://www.image-net.org/challenges/LSVRC/2013/" target="_blank" rel="noopener">ImageNet ILSVRC 2013</a> æ•°æ®é›†è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œå‰è€…å¯è¯†åˆ« 20 ä¸ªç±»å‹ï¼Œåè€…å¯è¯†åˆ« 200 ä¸ªç±»å‹ã€‚ç„¶è€Œè¿™ 220 ä¸ªç±»å‹å¹¶ä¸åŒ…æ‹¬äººè„¸ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±è®­ç»ƒã€‚</p>
<h2 id="ä¸‹è½½æ•°æ®é›†"><a href="#ä¸‹è½½æ•°æ®é›†" class="headerlink" title="ä¸‹è½½æ•°æ®é›†"></a>ä¸‹è½½æ•°æ®é›†</h2><p>æˆ‘ä¸‹è½½çš„æ˜¯é¦™æ¸¯ä¸­æ–‡å¤§å­¦å¤šåª’ä½“å®éªŒå®¤çš„ <a href="http://mmlab.ie.cuhk.edu.hk/projects/CelebA.html" target="_blank" rel="noopener">CelebA</a> æ•°æ®é›†ï¼Œè¿™æ˜¯ä¸€ä¸ªäººè„¸æ•°æ®é›†ï¼Œä¸€å…±æœ‰ 20 å¤šä¸‡å¼ å›¾ç‰‡ã€‚å®˜æ–¹ä¹Ÿæä¾›äº†æŸåº¦ç›˜çš„<a href="http://pan.baidu.com/s/1eSNpdRG" target="_blank" rel="noopener">é“¾æ¥</a>ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä¸‹è½½çš„æ–‡ä»¶ï¼š</p>
<p><strong>1. æœ‰ç¯å¢ƒçš„å›¾ç‰‡ï¼ˆIn-The-Wild Imagesï¼‰</strong></p>
<p>åœ¨åº¦ç›˜çš„ <code>Img/img_celeba.7z</code> æ–‡ä»¶å¤¹ä¸­ã€‚ç”±äºå›¾ç‰‡éå¸¸å¤šï¼Œè¿™ä¸ªå‹ç¼©åŒ…å¾ˆå¤§ï¼Œæ‰€ä»¥ä½œè€…è¿›è¡Œäº†åˆ†å·å‹ç¼©ï¼Œæœ‰ 14 ä¸ªæ–‡ä»¶ï¼ˆ<code>img_celeba.7z.001</code> åˆ° <code>img_celeba.7z.014</code>ï¼‰ï¼Œä¸€å…± 9 ä¸ªå¤š Gã€‚æˆ‘åœ¨ Windows ç”¨åº¦ç›˜å®¢æˆ·ç«¯ä¸‹çš„ï¼Œä¸ç„¶é€Ÿåº¦ä¼šæ—¶ä¸æ—¶åœ°å½’é›¶ã€‚ä¸‹è½½ä¸‹æ¥åä¹Ÿåœ¨ Windows ä¸‹çš„å‘½ä»¤æç¤ºç¬¦ä¸­è¿›è¡Œåˆ†å·çš„åˆå¹¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy /b img_celeba.7z.* img_celeba.7z</span><br></pre></td></tr></table></figure>
<p>å¾ˆæ…¢å•Šï¼Œå› ä¸ºå¤ªå¤§äº†ã€‚åˆå¹¶å¥½äº†ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„å‹ç¼©åŒ… <code>img_celeba.7z</code>ï¼Œç„¶åè§£å‹ã€‚</p>
<p><strong>2. æ ‡æ³¨ä¿¡æ¯ï¼ˆBounding Box Annotationsï¼‰</strong></p>
<p>è®­ç»ƒå’Œæµ‹è¯•çš„æ—¶å€™ï¼Œéœ€è¦å‘Šè¯‰ç¨‹åºä¸€å¼ å›¾ç‰‡å“ªä¸ªåœ°æ–¹æ‰æ˜¯äººè„¸ï¼Œæ‰€ä»¥éœ€è¦æ ‡æ³¨æ¡†ï¼Œæ ‡æ³¨ä¿¡æ¯æä¾›äº†æ¯å¼ å›¾ç‰‡ä¸­äººè„¸æ ‡æ³¨æ¡†çš„åæ ‡ã€‚åœ¨åº¦ç›˜çš„ <code>Anno/list_bbox_celeba.txt</code>ï¼Œç›´æ¥ä¸‹è½½å³å¯ã€‚</p>
<h2 id="è½¬æ¢æ•°æ®é›†"><a href="#è½¬æ¢æ•°æ®é›†" class="headerlink" title="è½¬æ¢æ•°æ®é›†"></a>è½¬æ¢æ•°æ®é›†</h2><p>å…¶å®ä½œè€…æä¾›äº†ä½¿ç”¨è‡ªå·±çš„æ•°æ®é›†è®­ç»ƒ R-CNN çš„<a href="https://github.com/rbgirshick/rcnn#training-an-r-cnn-detector-on-another-dataset" target="_blank" rel="noopener">æ•™ç¨‹</a>ï¼Œä½†æ˜¯å†™å¾—å¾ˆç²—ç•¥ï¼Œä¸»è¦å°±æ˜¯éœ€è¦å‡†å¤‡ä¸‰ä¸ªå‡½æ•°ï¼š</p>
<ul>
<li>è¿”å›æè¿°å›¾ç‰‡å’Œç±»å‹çš„ç»“æ„ä½“ï¼ˆå‚è€ƒ <code>imdb/imdb_from_voc.m</code>ï¼‰</li>
<li>è¿”å›æ„Ÿå…´è¶£åŒºåŸŸï¼ˆå³æ ‡æ³¨æ¡†ï¼‰çš„ç»“æ„ä½“ï¼ˆå‚è€ƒ <code>imdb/roidb_from_voc.m</code>ï¼‰</li>
<li>æä¾›è¯„ä¼°åŠŸèƒ½ï¼ˆå‚è€ƒ <code>imdb/imdb_eval_voc.m</code>ï¼‰</li>
</ul>
<p>ä¹Ÿå¯ä»¥æŠŠè‡ªå·±çš„æ•°æ®é›†è½¬æ¢æˆ PASCAL VOC çš„æ ¼å¼ï¼Œè¿™æ ·å°±å¯ä»¥é‡ç”¨ä½œè€…çš„ä»£ç äº†ï¼Œæˆ‘å°±æ˜¯ä½¿ç”¨çš„è¿™ç§æ–¹å¼ã€‚</p>
<h3 id="æ•°æ®é›†ç»“æ„"><a href="#æ•°æ®é›†ç»“æ„" class="headerlink" title="æ•°æ®é›†ç»“æ„"></a>æ•°æ®é›†ç»“æ„</h3><p>æˆ‘ä»¥å‰æœ‰ä¸‹è¿‡ PASCAL VOC 2007 æ•°æ®é›†ï¼Œå…ˆç”¨ <code>tree -d</code> å‘½ä»¤çœ‹ä¸‹ç›®å½•ç»“æ„å§ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1771371-f0091bb3f2535c8f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="PASCAL VOC 2007 æ•°æ®é›†ç»“æ„"></p>
<p>æ¥ä¸‹æ¥ä»¿ç…§æ­¤ç»“æ„ï¼Œæ„å»ºè‡ªå·±çš„æ•°æ®é›†ã€‚</p>
<p>å…ˆæŠŠ <code>rcnn/datasets/VOCdevkit2007</code> é“¾æ¥åˆ°å­˜æ”¾ CelebA æ•°æ®é›†çš„ç›®å½•ï¼ˆæˆ‘æ˜¯ <code>~/pascal_voc/celeba/VOCdevkit</code>ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ln -sf ~/pascal_voc/celeba/VOCdevkit  ~/rcnn/datasets/VOCdevkit2007</span><br></pre></td></tr></table></figure>
<p>å†åœ¨ <code>VOCdevkit</code> ä¸‹æ·»åŠ ä¸€äº›æ–‡ä»¶å¤¹ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">VOCdevkit</span><br><span class="line">â”œâ”€â”€ results</span><br><span class="line">â”‚Â Â  â””â”€â”€ VOC2007</span><br><span class="line">â”‚Â Â      â””â”€â”€ Main</span><br><span class="line">â”œâ”€â”€ VOC2007</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ Annotations</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ ImageSets</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ Main</span><br><span class="line">â”‚Â Â  â””â”€â”€ JPEGImages</span><br><span class="line">â””â”€â”€ VOCcode</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯æ¯ä¸ªæ–‡ä»¶å¤¹çš„è¯´æ˜ï¼š</p>
<ul>
<li><p><code>VOC2007/Annotations</code><br>å­˜æ”¾ <code>JPEGImages</code> æ–‡ä»¶å¤¹ä¸­å›¾ç‰‡çš„æ ‡æ³¨ä¿¡æ¯ï¼Œä¸å›¾ç‰‡æ–‡ä»¶åŒåä¸”ä¸€ä¸€å¯¹åº”ï¼Œä¸º <code>xml</code> æ ¼å¼ã€‚</p>
</li>
<li><p><code>VOC2007/ImageSets/Main</code><br>å­˜æ”¾å››ä¸ª <code>txt</code> æ–‡ä»¶ï¼š<code>train.txt</code>ã€<code>val.txt</code>ã€<code>trainval.txt</code>ã€<code>test.txt</code>ï¼Œåˆ†åˆ«å®šä¹‰è®­ç»ƒã€éªŒè¯ã€è®­ç»ƒå’ŒéªŒè¯ã€æµ‹è¯•å››ç§æ•°æ®é›†ä¸­çš„å›¾ç‰‡ï¼Œè¿™äº›æ–‡ä»¶é‡Œçš„æ¯ä¸€è¡Œæ–‡æœ¬éƒ½æ˜¯ä¸€ä¸ª image identifierï¼Œå…¶å®ä¹Ÿå°±æ˜¯å›¾ç‰‡çš„æ–‡ä»¶åã€‚</p>
</li>
<li><p><code>VOC2007/JPEGImages</code><br>å­˜æ”¾æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶ã€‚</p>
</li>
<li><p><code>VOCcode</code><br>å­˜æ”¾åŠ è½½ã€å¤„ç†æ•°æ®é›†çš„ä»£ç ã€‚ç›´æ¥å°† PASCAL VOC 2007 æ•°æ®é›†ä¸­çš„ <code>VOCdevkit/VOCcode</code> æ–‡ä»¶å¤¹å¤åˆ¶åˆ°è¿™é‡Œå°±è¡Œã€‚</p>
</li>
<li><p><code>results/VOC2007/Main</code><br>æµ‹è¯•çš„æ—¶å€™ä¼šåœ¨æ­¤æ–‡ä»¶å¤¹ä¸‹ä¸´æ—¶å­˜æ”¾ä¸€ä¸ªæ–‡ä»¶ï¼Œæ²¡æœ‰è¿™ä¸ªè·¯å¾„çš„è¯ä¼šæŠ¥é”™ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Error using fprintf</span><br><span class="line">Invalid file identifier.  Use fopen to generate a valid file identifier.</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="å‡†å¤‡å›¾ç‰‡"><a href="#å‡†å¤‡å›¾ç‰‡" class="headerlink" title="å‡†å¤‡å›¾ç‰‡"></a>å‡†å¤‡å›¾ç‰‡</h3><p>PASCAL VOC 2007 æ•°æ®é›†ä¸­åŒ…å« 20 ç±»å›¾ç‰‡ï¼Œä½†æ˜¯æˆ‘åªéœ€è¦æ£€æµ‹ä¸€ç±»ï¼Œå°±æ˜¯äººè„¸ï¼Œæ‰€ä»¥åˆ°åº•ä½¿ç”¨å¤šå°‘å¼ å›¾ç‰‡åˆé€‚å‘¢ï¼Ÿæˆ‘è‡ªå·±å†™äº†ä¸ª Python è„šæœ¬ï¼Œè¯»å– <code>Annotations</code> æ–‡ä»¶å¤¹ä¸­çš„ xml æ–‡ä»¶åˆ†æäº†ä¸€ä¸‹æ¯ä¸ªç±»å‹åœ¨æ‰€æœ‰å›¾ç‰‡ä¸­å‡ºç°çš„æ¬¡æ•°ï¼Œç»“æœå¦‚å›¾ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1771371-efb95ccbb5a61169.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ¯ä¸ªç±»å‹å‡ºç°çš„æ¬¡æ•°"></p>
<p>æ„Ÿè§‰æ¯ä¸ªç±»å‹å‡ºç°çš„æ¬¡æ•°ä¹Ÿä¸å¤šï¼Œé‚£æˆ‘å°±é€‰ CelebA æ•°æ®é›†ä¸­å‰ 1000 å¼ å›¾ç‰‡å§ï¼Œåº”è¯¥å¤Ÿç”¨äº†ã€‚æŠŠ CelebA æ•°æ®é›†ä¸­æ–‡ä»¶åä¸º <code>000001.jpg</code> åˆ° <code>001000.jpg</code> çš„å›¾ç‰‡æ”¾åˆ° <code>VOCdevkit/VOC2007/JPEGImages</code> é‡Œã€‚</p>
<h3 id="å‡†å¤‡æ ‡æ³¨æ–‡ä»¶"><a href="#å‡†å¤‡æ ‡æ³¨æ–‡ä»¶" class="headerlink" title="å‡†å¤‡æ ‡æ³¨æ–‡ä»¶"></a>å‡†å¤‡æ ‡æ³¨æ–‡ä»¶</h3><p>PASCAL VOC 2007 æ•°æ®é›†çš„æ ‡æ³¨æ–‡ä»¶ä¸º xml æ ¼å¼çš„ï¼Œä»¥ <code>000002.xml</code> ä¸ºä¾‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">annotation</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">folder</span>&gt;</span>VOC2007<span class="tag">&lt;/<span class="name">folder</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- å›¾ç‰‡çš„æ–‡ä»¶å --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filename</span>&gt;</span>000002.jpg<span class="tag">&lt;/<span class="name">filename</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">database</span>&gt;</span>The VOC2007 Database<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">annotation</span>&gt;</span>PASCAL VOC2007<span class="tag">&lt;/<span class="name">annotation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span>&gt;</span>flickr<span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">flickrid</span>&gt;</span>329145082<span class="tag">&lt;/<span class="name">flickrid</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">owner</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">flickrid</span>&gt;</span>hiromori2<span class="tag">&lt;/<span class="name">flickrid</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Hiroyuki Mori<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">owner</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- å›¾ç‰‡å®½ã€é«˜ã€æ·±åº¦ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">size</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">width</span>&gt;</span>335<span class="tag">&lt;/<span class="name">width</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">height</span>&gt;</span>500<span class="tag">&lt;/<span class="name">height</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">depth</span>&gt;</span>3<span class="tag">&lt;/<span class="name">depth</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">size</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">segmented</span>&gt;</span>0<span class="tag">&lt;/<span class="name">segmented</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">object</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>train<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pose</span>&gt;</span>Unspecified<span class="tag">&lt;/<span class="name">pose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">truncated</span>&gt;</span>0<span class="tag">&lt;/<span class="name">truncated</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">difficult</span>&gt;</span>0<span class="tag">&lt;/<span class="name">difficult</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ ‡æ³¨æ¡†ä¿¡æ¯ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bndbox</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">xmin</span>&gt;</span>139<span class="tag">&lt;/<span class="name">xmin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ymin</span>&gt;</span>200<span class="tag">&lt;/<span class="name">ymin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">xmax</span>&gt;</span>207<span class="tag">&lt;/<span class="name">xmax</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ymax</span>&gt;</span>301<span class="tag">&lt;/<span class="name">ymax</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bndbox</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">annotation</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>CelebA æä¾›çš„æ ‡æ³¨ä¿¡æ¯éƒ½å­˜æ”¾åœ¨ <code>list_bbox_celeba.txt</code> ä¸­ã€‚æ­¤æ–‡æœ¬é™¤ 1ã€2 è¡Œå¤–ï¼Œå…¶ä½™è¡Œå‡ä¸ºå„å›¾ç‰‡çš„æ ‡æ³¨ä¿¡æ¯ï¼Œæ ¼å¼ä¸º</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">åˆ—æ•°</th>
<th style="text-align:center">å†…å®¹</th>
<th style="text-align:center">ä¾‹å­</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">å›¾ç‰‡æ–‡ä»¶å</td>
<td style="text-align:center">000002.jpg</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">æ ‡æ³¨æ¡†å·¦ä¸Šè§’xåæ ‡</td>
<td style="text-align:center">72</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">æ ‡æ³¨æ¡†å·¦ä¸Šè§’yåæ ‡</td>
<td style="text-align:center">94</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">æ ‡æ³¨æ¡†å®½</td>
<td style="text-align:center">221</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">æ ‡æ³¨æ¡†é«˜</td>
<td style="text-align:center">306</td>
</tr>
</tbody>
</table>
</div>
<p>éœ€è¦åˆ©ç”¨è¿™äº›ä¿¡æ¯æ¥æ„å»º xml æ ¼å¼çš„æ ‡æ³¨æ–‡ä»¶ï¼Œå½“ç„¶ï¼Œæ‰‹åŠ¨è½¬æ¢æ˜¯ä¸ç°å®çš„ï¼Œæ‰€ä»¥æˆ‘å†™äº†ä¸ª Python è„šæœ¬æ¥è½¬æ¢ï¼Œä½¿ç”¨äº† PASCAL VOC 2007 æ•°æ®é›†ä¸­çš„æ ‡æ³¨æ–‡ä»¶ <code>000002.xml</code> ä½œä¸ºæ¨¡æ¿ï¼Œä»…ä»…å°†æ¨¡æ¿ä¸­çš„ <code>filename</code>ã€<code>size</code>ã€<code>bndbox</code> å…ƒç´ ä¿®æ”¹äº†å°±è¡Œï¼Œå…¶ä»–çš„ä¸åŠ¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xml.etree.cElementTree <span class="keyword">as</span> ET</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨000002.xmlä½œä¸ºæ¨¡æ¿ï¼Œå› ä¸ºå®ƒåªæœ‰ä¸€ä¸ªobjectå…ƒç´ </span></span><br><span class="line">template_file = <span class="string">'/home/zack/pascal_voc/2007/VOCdevkit/VOC2007/Annotations/000002.xml'</span></span><br><span class="line"><span class="comment"># ç”Ÿæˆçš„xmlæ–‡ä»¶ä¿å­˜çš„è·¯å¾„</span></span><br><span class="line">target_dir = <span class="string">'/home/zack/pascal_voc/celeba/VOCdevkit/VOC2007/Annotations/'</span></span><br><span class="line"><span class="comment"># æ‰€æœ‰å›¾ç‰‡çš„è·¯å¾„</span></span><br><span class="line">image_dir = <span class="string">'/home/zack/pascal_voc/celeba/VOCdevkit/VOC2007/JPEGImages/'</span></span><br><span class="line"><span class="comment"># ç»™å‡ºæ‰€æœ‰æ ‡æ³¨ä¿¡æ¯çš„æ–‡ä»¶ï¼Œç”±CelebAæä¾›</span></span><br><span class="line">bbox_file = <span class="string">'/home/zack/celeba/list_bbox_celeba.txt'</span></span><br><span class="line"><span class="comment"># å›¾ç‰‡æ•°é‡</span></span><br><span class="line">image_num = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line">bboxes = open(bbox_file, <span class="string">'r'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> bbox <span class="keyword">in</span> bboxes.readlines()[<span class="number">2</span> : image_num + <span class="number">2</span>]:</span><br><span class="line">    bb_info = bbox.split()</span><br><span class="line">    image_file = bb_info[<span class="number">0</span>]</span><br><span class="line">    x_1 = int(bb_info[<span class="number">1</span>])</span><br><span class="line">    y_1 = int(bb_info[<span class="number">2</span>])</span><br><span class="line">    width = int(bb_info[<span class="number">3</span>])</span><br><span class="line">    height = int(bb_info[<span class="number">4</span>])</span><br><span class="line"></span><br><span class="line">    tree = ET.parse(template_file)</span><br><span class="line">    root = tree.getroot()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># filename</span></span><br><span class="line">    root.find(<span class="string">'filename'</span>).text = image_file</span><br><span class="line"></span><br><span class="line">    <span class="comment"># size</span></span><br><span class="line">    sz = root.find(<span class="string">'size'</span>)</span><br><span class="line">    im = cv2.imread(image_dir + image_file)</span><br><span class="line">    sz.find(<span class="string">'width'</span>).text = str(im.shape[<span class="number">0</span>])</span><br><span class="line">    sz.find(<span class="string">'height'</span>).text = str(im.shape[<span class="number">1</span>])</span><br><span class="line">    sz.find(<span class="string">'depth'</span>).text = str(im.shape[<span class="number">2</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># object</span></span><br><span class="line">    obj = root.find(<span class="string">'object'</span>)</span><br><span class="line">    obj.find(<span class="string">'name'</span>).text = <span class="string">'face'</span></span><br><span class="line">    bb = obj.find(<span class="string">'bndbox'</span>)</span><br><span class="line">    bb.find(<span class="string">'xmin'</span>).text = str(x_1)</span><br><span class="line">    bb.find(<span class="string">'ymin'</span>).text = str(y_1)</span><br><span class="line">    bb.find(<span class="string">'xmax'</span>).text = str(x_1 + width)</span><br><span class="line">    bb.find(<span class="string">'ymax'</span>).text = str(y_1 + height)</span><br><span class="line"></span><br><span class="line">    xml_file = image_file.replace(<span class="string">'jpg'</span>, <span class="string">'xml'</span>)</span><br><span class="line"></span><br><span class="line">    tree.write(target_dir + xml_file)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> xml_file</span><br><span class="line"></span><br><span class="line">bboxes.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Done'</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œä»¥ä¸Šè„šæœ¬åï¼Œæ‰€æœ‰çš„æ ‡æ³¨æ¡†æ–‡ä»¶å°±å·²ç»ç”Ÿæˆäº†ã€‚å¦‚æœå‡ºç° <code>ImportError: No module named cv2</code> çš„é”™è¯¯ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… OpenCV çš„ Python æ¥å£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install python-opencv`</span><br></pre></td></tr></table></figure>
<h3 id="å‡†å¤‡æ•°æ®é›†é…ç½®æ–‡ä»¶"><a href="#å‡†å¤‡æ•°æ®é›†é…ç½®æ–‡ä»¶" class="headerlink" title="å‡†å¤‡æ•°æ®é›†é…ç½®æ–‡ä»¶"></a>å‡†å¤‡æ•°æ®é›†é…ç½®æ–‡ä»¶</h3><p>é…ç½®æ–‡ä»¶å³ <code>ImageSets/Main</code> ä¸‹çš„å››ä¸ªæ–‡ä»¶ï¼Œå®šä¹‰å››ç§æ•°æ®é›†ï¼Œè¿™å››ç§æ•°æ®é›†ä¸­çš„å›¾ç‰‡ä¼šè¢«åˆ†åˆ«ç”¨æ¥åšè®­ç»ƒã€éªŒè¯ã€è®­ç»ƒå’ŒéªŒè¯ã€æµ‹è¯•ã€‚æˆ‘çœ‹äº†çœ‹ PASCAL VOC 2007 ä¸­å››ä¸ªæ•°æ®é›†çš„åˆ†é…ï¼Œå‘ç°æ¯ä¸ªæ•°æ®é›†ä¸­çš„å›¾ç‰‡åº”è¯¥æ˜¯éšæœºæŠ½å–çš„ï¼Œä½†éœ€è¦æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ï¼š <code>trainval</code> å’Œ <code>test</code> çº¦ä¸ºæ€»å›¾ç‰‡æ•°çš„ä¸€åŠï¼Œä½†ä¸é‡åˆï¼Œå³é€‰å‡ºå…¶ä¸­ä¸€ä¸ªæ•°æ®é›†çš„å›¾ç‰‡åï¼Œå¦ä¸€ä¸ªæ•°æ®é›†çš„å›¾ç‰‡å°±æ˜¯é€‰å‰©ä¸‹çš„å›¾ç‰‡äº†ï¼Œè€Œ <code>train</code> å’Œ <code>val</code> çº¦å  <code>trainval</code> çš„ä¸€åŠï¼ŒåŒæ ·ä¸é‡åˆã€‚æ‰€ä»¥æˆ‘ä¹Ÿç”¨è¿™ä¸ªæ¯”ä¾‹æ¥åˆ¶ä½œè¿™å››ä¸ªæ•°æ®é›†å§ã€‚ä¾ç„¶å†™äº†ä¸ª Python è„šæœ¬ï¼ˆPython çœŸæ˜¯å¤ªå¥½ç”¨äº† ğŸ¤£ï¼‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆçš„txtæ–‡ä»¶å­˜æ”¾çš„ç›®å½•</span></span><br><span class="line">target_dir = <span class="string">'/home/zack/pascal_voc/celeba/VOCdevkit/VOC2007/ImageSets/Main/'</span></span><br><span class="line"><span class="comment"># æ‰€æœ‰å›¾ç‰‡çš„è·¯å¾„</span></span><br><span class="line">image_dir = <span class="string">'/home/zack/pascal_voc/celeba/VOCdevkit/VOC2007/JPEGImages/'</span></span><br><span class="line"></span><br><span class="line">image_files = os.listdir(image_dir)</span><br><span class="line">image_ids = [image_id.replace(<span class="string">'.jpg'</span>, <span class="string">'\n'</span>) <span class="keyword">for</span> image_id <span class="keyword">in</span> image_files]</span><br><span class="line">image_ids.sort()</span><br><span class="line"></span><br><span class="line"><span class="comment"># trainval &amp; test</span></span><br><span class="line">trainval = open(target_dir + <span class="string">'trainval.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">test = open(target_dir + <span class="string">'test.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">trainval_ids = random.sample(image_ids, len(image_ids) / <span class="number">2</span>)</span><br><span class="line">trainval_ids.sort()</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> image_id <span class="keyword">in</span> image_ids:</span><br><span class="line">    <span class="keyword">if</span> i &lt; len(trainval_ids) <span class="keyword">and</span> image_id == trainval_ids[i]:</span><br><span class="line">        trainval.write(image_id)</span><br><span class="line">        i+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        test.write(image_id)</span><br><span class="line">trainval.close()</span><br><span class="line">test.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># train &amp; val</span></span><br><span class="line">train = open(target_dir + <span class="string">'train.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">val = open(target_dir + <span class="string">'val.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">train_ids = random.sample(trainval_ids, len(trainval_ids) / <span class="number">2</span>)</span><br><span class="line">train_ids.sort()</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> trainval_id <span class="keyword">in</span> trainval_ids:</span><br><span class="line">    <span class="keyword">if</span> i &lt; len(train_ids) <span class="keyword">and</span> trainval_id == train_ids[i]:</span><br><span class="line">        train.write(trainval_id)</span><br><span class="line">        i+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        val.write(trainval_id)</span><br><span class="line">train.close()</span><br><span class="line">val.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Done'</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œä»¥ä¸Šè„šæœ¬åï¼Œæ‰€æœ‰çš„é…ç½®æ–‡ä»¶å°±å·²ç»ç”Ÿæˆäº†ã€‚</p>
<h2 id="ä¿®æ”¹ç›¸å…³ä»£ç "><a href="#ä¿®æ”¹ç›¸å…³ä»£ç " class="headerlink" title="ä¿®æ”¹ç›¸å…³ä»£ç "></a>ä¿®æ”¹ç›¸å…³ä»£ç </h2><p>ä¿®æ”¹ <code>VOCdevkit/VOCcode/VOCinit.m</code>ï¼Œ81-101 è¡Œå®šä¹‰äº† PASCAL VOC 2007 æ•°æ®é›†ä¸­å›¾ç‰‡çš„ 20 ç§åˆ†ç±»ï¼Œå°†è¿™äº›åˆ†ç±»å…¨éƒ¨åˆ é™¤ï¼Œæ›¿æ¢æˆä¸€ç§åˆ†ç±» â€”â€” faceï¼Œå³æ›¿æ¢æˆ <code>VOCopts.classes={&#39;face&#39;};</code>ã€‚</p>
<h1 id="è®­ç»ƒæ¨¡å‹"><a href="#è®­ç»ƒæ¨¡å‹" class="headerlink" title="è®­ç»ƒæ¨¡å‹"></a>è®­ç»ƒæ¨¡å‹</h1><p>è®­ç»ƒè¿‡ç¨‹ä¸»è¦å‚è€ƒäº†ä½œè€…æä¾›çš„ä½¿ç”¨ PASCAL VOC 2007 æ•°æ®é›†æ¥è®­ç»ƒ R-CNN çš„<a href="https://github.com/rbgirshick/rcnn#training-an-r-cnn-detector-on-another-dataset" target="_blank" rel="noopener">æ•™ç¨‹</a>ï¼Œå¤§è‡´æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p><strong>è®¡ç®—å€™é€‰åŒºåŸŸ</strong> â†’ <strong>è°ƒä¼˜CNN</strong> â†’ <strong>æå–ç‰¹å¾</strong> â†’ <strong>è®­ç»ƒä¸æµ‹è¯•</strong></p>
<h2 id="è®¡ç®—å€™é€‰åŒºåŸŸ"><a href="#è®¡ç®—å€™é€‰åŒºåŸŸ" class="headerlink" title="è®¡ç®—å€™é€‰åŒºåŸŸ"></a>è®¡ç®—å€™é€‰åŒºåŸŸ</h2><p>ä½œè€…æä¾›çš„æ•™ç¨‹çš„ç¬¬ä¸€æ­¥å°±æ˜¯æå–ç‰¹å¾ï¼ˆextract featuresï¼‰ï¼Œé‚£æ˜¯å› ä¸ºä»–ç»™å‡ºçš„æ˜¯ä½¿ç”¨ PASCAL VOC 2007 æ•°æ®é›†æ¥è®­ç»ƒ R-CNN çš„æ•™ç¨‹ï¼Œç„¶è€Œæˆ‘æ˜¯ç”¨è‡ªå·±çš„æ•°æ®é›†æ¥è®­ç»ƒï¼Œæ‰€ä»¥éœ€è¦å…ˆä½¿ç”¨ <a href="https://www.koen.me/research/selectivesearch/" target="_blank" rel="noopener">Selective Search</a> ç®—æ³•è®¡ç®—ä¸€ä¸‹å€™é€‰åŒºåŸŸã€‚</p>
<div class="note warning">
            <p>å¦‚æœå·²ç»è¿è¡Œè¿‡ R-CNN çš„ demoï¼Œé‚£å°±ä¸€å®šæ‰§è¡Œè¿‡ <code>rcnn/data</code> ä¸‹çš„ <code>fetch_selective_search_data.sh</code> è„šæœ¬ï¼Œåœ¨ <code>selective_selective_data</code> æ–‡ä»¶å¤¹ä¸‹å°±ä¸€å®šæœ‰ä¸€ç³»åˆ—çš„ <code>.mat</code> æ–‡ä»¶ï¼Œè¿™å°±æ˜¯ä½œè€…é¢„å…ˆè®¡ç®—å¥½çš„å€™é€‰åŒºåŸŸä¿¡æ¯ï¼ˆå®é™…ä¸Šæ˜¯å€™é€‰åŒºåŸŸçš„åæ ‡ï¼‰ã€‚å¦‚æœä¸è‡ªè¡Œè®¡ç®—å€™é€‰åŒºåŸŸï¼Œä¸‹ä¸€æ­¥æå–ç‰¹å¾çš„æ—¶å€™å°±ä¼šä½¿ç”¨ <code>voc_2007_*.mat</code> ä¸­å‚¨å­˜çš„å€™é€‰åŒºåŸŸä¿¡æ¯ï¼Œä¼šä½¿ç»“æœå‡ºé”™ã€‚</p>
          </div>
<p>ä½œè€…åœ¨ <code>rcnn/selective_search</code> æ–‡ä»¶å¤¹ä¸‹æä¾›äº†ä½¿ç”¨ Selective Search ç®—æ³•è®¡ç®—å€™é€‰åŒºåŸŸçš„å‡½æ•° <code>selective_search_boxes.m</code>ã€‚æˆ‘å†™äº†ä¸€ä¸ª MATLAB å‡½æ•°æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œç”Ÿæˆå‚¨å­˜å€™é€‰åŒºåŸŸçš„æ–‡ä»¶ï¼š</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">selective_search_boxes_generator</span><span class="params">(chunk)</span></span></span><br><span class="line"></span><br><span class="line">mat_file = sprintf(<span class="string">'./data/selective_search_data/voc_2007_%s.mat'</span>, chunk);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> exist(mat_file, <span class="string">'file'</span>)</span><br><span class="line">  fprintf(<span class="string">'File exists\n'</span>);</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">image_ids = load(sprintf(<span class="string">'./datasets/VOCdevkit2007/VOC2007/ImageSets/Main/%s.txt'</span>, chunk));</span><br><span class="line">image_num = <span class="built_in">size</span>(image_ids, <span class="number">1</span>);</span><br><span class="line">images = cell(<span class="number">1</span>, image_num);</span><br><span class="line">boxes = cell(<span class="number">1</span>, image_num);</span><br><span class="line"></span><br><span class="line">fprintf(<span class="string">'Computing candidate regions...\n'</span>);</span><br><span class="line">th = tic();</span><br><span class="line">fast_mode = <span class="built_in">true</span>;</span><br><span class="line">im_width = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">parfor</span> <span class="built_in">i</span> = <span class="number">1</span> : image_num</span><br><span class="line">  image_id = sprintf(<span class="string">'%06d'</span>, image_ids(<span class="built_in">i</span>));</span><br><span class="line">  images&#123;<span class="number">1</span>, <span class="built_in">i</span>&#125; = image_id;</span><br><span class="line">  image_file = sprintf(<span class="string">'./datasets/VOCdevkit2007/VOC2007/JPEGImages/%s.jpg'</span>, image_id);</span><br><span class="line">  im = imread(image_file);</span><br><span class="line">  box = selective_search_boxes(im, fast_mode, im_width);</span><br><span class="line">  <span class="comment">% éœ€è¦å–æ•´ï¼Œå¦åˆ™ä¹‹åè°ƒä¼˜è®­ç»ƒçš„lossä¼šä¸€ç›´ä¸º0</span></span><br><span class="line">  boxes&#123;<span class="number">1</span>, <span class="built_in">i</span>&#125; = <span class="built_in">round</span>(box);</span><br><span class="line">  fprintf(<span class="string">'%s.jpg\n'</span>, image_id);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">fprintf(<span class="string">'Finished, costs %.3fs\n'</span>, toc(th));</span><br><span class="line">fprintf(<span class="string">'Saving MAT file to %s...\n'</span>, mat_file);</span><br><span class="line"></span><br><span class="line">save(mat_file, <span class="string">'images'</span>, <span class="string">'boxes'</span>);</span><br><span class="line"></span><br><span class="line">fprintf(<span class="string">'Done\n'</span>);</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨æ­¤å‡½æ•°å‰ï¼Œéœ€è¦å…ˆç§»èµ° <code>rcnn/data/selective_selective_data</code> æ–‡ä»¶å¤¹ä¸‹çš„ <code>voc_2007_train.mat</code>ã€<code>voc_2007_val.mat</code>ã€<code>voc_2007_trainval.mat</code>ã€<code>voc_2007_test.mat</code> å››ä¸ªæ–‡ä»¶ï¼Œç„¶ååœ¨ <code>rcnn</code> ç›®å½•ä¸‹æ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; selective_search_boxes_generator(&apos;train&apos;);</span><br><span class="line">&gt;&gt; selective_search_boxes_generator(&apos;val&apos;);</span><br><span class="line">&gt;&gt; selective_search_boxes_generator(&apos;trainval&apos;);</span><br><span class="line">&gt;&gt; selective_search_boxes_generator(&apos;test&apos;);</span><br></pre></td></tr></table></figure>
<p>æ€»å…±èŠ±è´¹äº†å°†è¿‘ 1 ä¸ªå°æ—¶ã€‚æ‰§è¡Œå®Œæ¯•åï¼Œåœ¨ <code>selective_selective_data</code> æ–‡ä»¶å¤¹ä¸‹åˆç”Ÿæˆäº†åˆšæ‰ç§»èµ°çš„å››ä¸ªæ–‡ä»¶ï¼Œä¸è¿‡ç°åœ¨ï¼Œè¿™å››ä¸ªæ–‡ä»¶é‡Œå°±æ˜¯æˆ‘è‡ªå·±çš„æ•°æ®é›†çš„å€™é€‰åŒºåŸŸä¿¡æ¯äº†ã€‚</p>
<h2 id="è°ƒä¼˜-CNN"><a href="#è°ƒä¼˜-CNN" class="headerlink" title="è°ƒä¼˜ CNN"></a>è°ƒä¼˜ CNN</h2><p>è¿™ä¸€æ­¥ï¼Œå°†è®¡ç®—å‡ºçš„å€™é€‰åŒºåŸŸä½œä¸ºè¾“å…¥ï¼Œé€å…¥ CNN è¿›è¡Œè®­ç»ƒã€‚ä½¿ç”¨é¢„è®­ç»ƒçš„æ¨¡å‹ <code>ilsvrc_2012_train_iter_310k</code>ï¼ˆ<a href="http://www.image-net.org/challenges/LSVRC/2012/" target="_blank" rel="noopener">ImageNet ILSVRC 2012</a> æ•°æ®é›†è®­ç»ƒ <a href="http://papers.nips.cc/paper/4824-imagenet-classification-with-deep-convolutional-neural-networks" target="_blank" rel="noopener">AlexNet</a> ç½‘ç»œç”Ÿæˆçš„æ¨¡å‹ï¼‰åˆå§‹åŒ–ç½‘ç»œå‚æ•°ï¼Œç„¶åå†å°†ä¸Šä¸€æ­¥å¾—åˆ°çš„å€™é€‰åŒºåŸŸé€å…¥è¯¥ç½‘ç»œè¿›è¡Œè®­ç»ƒï¼Œå³è°ƒä¼˜ï¼ˆfine-tuneï¼‰ã€‚</p>
<p>ä½œè€…åœ¨æ•™ç¨‹ä¸­å¹¶æ²¡æœ‰ç»™å‡ºè°ƒä¼˜ CNN çš„æ­¥éª¤ï¼ŒåŒæ ·å› ä¸ºæ•™ç¨‹æ˜¯é¢å‘ PASCAL VOC 2007 æ•°æ®é›†çš„ï¼Œå¦‚æœä¸‹ä¸€æ­¥ç›´æ¥ä½¿ç”¨ä½œè€…æä¾›çš„ç”¨ PASCAL VOC 2007 æ•°æ®é›†è°ƒä¼˜åçš„ CNN æ¨¡å‹ <code>finetune_voc_2007_trainval_iter_70k</code> æ¥æå–ç‰¹å¾ï¼Œæœ€ç»ˆçš„ç²¾åº¦å°±ä¼šæœ‰æŸå¤±ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨è‡ªå·±çš„æ•°æ®é›†å¯¹ CNN è¿›è¡Œè°ƒä¼˜ã€‚è°ƒä¼˜çš„æ­¥éª¤å‚è€ƒäº†ä½œè€…æä¾›çš„ä½¿ç”¨ PASCAL VOC 2012 æ•°æ®é›†æ¥è°ƒä¼˜ CNN çš„<a href="https://github.com/rbgirshick/rcnn#fine-tuning-a-cnn-for-detection-with-caffe" target="_blank" rel="noopener">æ•™ç¨‹</a>ã€‚</p>
<h3 id="åŠ è½½æ•°æ®é›†"><a href="#åŠ è½½æ•°æ®é›†" class="headerlink" title="åŠ è½½æ•°æ®é›†"></a>åŠ è½½æ•°æ®é›†</h3><p>å°† <code>trainval</code>ã€<code>test</code> ä¸¤ä¸ªæ•°æ®é›†åŠ è½½åˆ° Workspaceï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; imdb_trainval = imdb_from_voc(&apos;datasets/VOCdevkit2007&apos;, &apos;trainval&apos;, &apos;2007&apos;);</span><br><span class="line">&gt;&gt; imdb_test = imdb_from_voc(&apos;datasets/VOCdevkit2007&apos;, &apos;test&apos;, &apos;2007&apos;);</span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»º-Window-Files"><a href="#åˆ›å»º-Window-Files" class="headerlink" title="åˆ›å»º Window Files"></a>åˆ›å»º Window Files</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; rcnn_make_window_file(imdb_trainval, &apos;external/caffe/examples/pascal-finetuning&apos;);</span><br><span class="line">&gt;&gt; rcnn_make_window_file(imdb_test, &apos;external/caffe/examples/pascal-finetuning&apos;);</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>rcnn/external/caffe/examples/pascal-finetuning</code> æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆäº† <code>window_file_voc_2007_trainval.txt</code> å’Œ <code>window_file_voc_2007_test.txt</code> ä¸¤ä¸ªæ–‡æœ¬æ–‡ä»¶ã€‚</p>
<h3 id="ä½¿ç”¨-Caffe-è¿›è¡Œè°ƒä¼˜"><a href="#ä½¿ç”¨-Caffe-è¿›è¡Œè°ƒä¼˜" class="headerlink" title="ä½¿ç”¨ Caffe è¿›è¡Œè°ƒä¼˜"></a>ä½¿ç”¨ Caffe è¿›è¡Œè°ƒä¼˜</h3><p>é€€å‡º MATLABï¼Œä½¿ç”¨ cd å‘½ä»¤è¿›å…¥ <code>rcnn</code> ç›®å½•ï¼Œå°†è°ƒä¼˜ä½¿ç”¨çš„ <code>prototxt</code> æ–‡ä»¶å¤åˆ¶åˆ° Caffe çš„ç›¸åº”ç›®å½•ä¸­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp finetuning/voc_2007_prototxt/pascal_finetune_* external/caffe/examples/pascal-finetuning/</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹ <code>prototxt</code> æ–‡ä»¶ï¼š</p>
<ul>
<li><p><code>pascal_finetune_solver.prototxt</code></p>
<ul>
<li>3 è¡Œï¼Œ<code>test_iter: 100</code> æ”¹æˆ <code>test_iter: 10</code>ï¼Œå®šä¹‰æµ‹è¯•éœ€è¦è¿­ä»£çš„æ¬¡æ•°ã€‚å› ä¸ºåé¢æˆ‘æŠŠ <code>pascal_finetune_val.prototxt</code> ä¸­çš„ <code>batch_size</code> è®¾ä¸ºäº† 50ï¼Œè¿­ä»£ 10 æ¬¡ï¼Œæ¯æ¬¡ 50 å¼ å›¾ç‰‡ï¼Œåˆšå¥½è¦†ç›– 500 å¼ ç”¨äºæµ‹è¯•çš„å›¾ç‰‡ã€‚</li>
<li>4 è¡Œï¼Œ<code>test_interval: 1000</code> æ”¹æˆ <code>test_interval: 500</code>ï¼Œå®šä¹‰è®­ç»ƒè¿­ä»£å¤šå°‘æ¬¡è¿›è¡Œä¸€æ¬¡æµ‹è¯•ã€‚å› ä¸ºè¿­ä»£æ¬¡æ•°ä¸å¤šï¼Œæµ‹è¯•çš„é¢‘ç‡å°±é«˜ä¸€ç‚¹å§ã€‚</li>
<li>10 è¡Œï¼Œ<code>max_iter: 100000</code> æ”¹ä¸º <code>max_iter: 20000</code>ï¼Œå®šä¹‰æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œä½œè€…è¯´ä»–åœ¨ PASCAL VOC 2012 æ•°æ®é›†ä¸Šè°ƒä¼˜ï¼Œè¿­ä»£äº† 7 ä¸‡æ¬¡ï¼Œä½†æ˜¯ 4 ä¸‡æ¬¡çš„æ—¶å€™å°±å·²ç»é¥±å’Œäº†ï¼Œæ‰€ä»¥æˆ‘å°±è°ƒå°äº†ç‚¹ã€‚</li>
<li>13 è¡Œï¼Œ<code>snapshot: 10000</code> æ”¹ä¸º <code>snapshot: 1000</code>ï¼Œå®šä¹‰è¿­ä»£å¤šå°‘æ¬¡åä¿å­˜ä¸€æ¬¡å¿«ç…§ï¼Œå¿«ç…§æ˜¯å½“å‰è¿­ä»£æ¬¡æ•°çš„æ¨¡å‹å’Œ solver çŠ¶æ€ï¼Œåè€…å¯ä»¥ç”¨æ¥æ¢å¤ä¸­æ–­çš„è®­ç»ƒï¼Œå› ä¸ºæˆ‘ä¸­é€”å¯èƒ½ä¼šä¸­æ–­è®­ç»ƒï¼Œæ‰€ä»¥å°±è°ƒå°äº†ç‚¹ã€‚</li>
</ul>
</li>
</ul>
<ul>
<li><p><code>pascal_finetune_train.prototxt</code></p>
<ul>
<li>10 è¡Œï¼Œ<code>batch_size: 128</code> æ”¹æˆ <code>batch_size: 64</code>ï¼Œå¦‚æœä¸æ”¹çš„è¯ï¼Œåœ¨æˆ‘çš„ç”µè„‘ä¸Šä¼šæŠ¥æ˜¾å­˜ä¸å¤Ÿçš„é”™è¯¯ï¼š<code>Check failed: error == cudaSuccess (2 vs. 0)  out of memory</code>ï¼Œæˆ‘ç”µè„‘æ˜¯ 2G çš„æ˜¾å­˜ã€‚</li>
<li>305 è¡Œï¼Œ<code>num_output: 21</code> æ”¹æˆ <code>num_output: 2</code>ï¼Œè¡¨ç¤ºä¸€ä¸ªç±»å‹ï¼ˆäººè„¸ï¼‰+ èƒŒæ™¯ã€‚</li>
</ul>
</li>
</ul>
<ul>
<li><p><code>pascal_finetune_val.prototxt</code></p>
<ul>
<li>10 è¡Œï¼Œ<code>batch_size: 128</code> æ”¹æˆ <code>batch_size: 50</code>ã€‚</li>
<li>305 è¡Œï¼Œ<code>num_output: 21</code> æ”¹æˆ <code>num_output: 2</code>ã€‚</li>
</ul>
</li>
</ul>
<p>æ¥ç€ï¼Œä½¿ç”¨ cd å‘½ä»¤è¿›å…¥ <code>external/caffe/examples/pascal-finetuning</code>ï¼Œæ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ GLOG_logtostderr=1 ../../build/tools/finetune_net.bin pascal_finetune_solver.prototxt &lt;åˆ°rcnnæ–‡ä»¶å¤¹çš„è·¯å¾„&gt;/rcnn/data/caffe_nets/ilsvrc_2012_train_iter_310k 2&gt;&amp;1 | tee log.txt</span><br></pre></td></tr></table></figure>
<p>å¼€å§‹è°ƒä¼˜è®­ç»ƒï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ¼«é•¿çš„ç­‰å¾…äº†ã€‚</p>
<p>åˆšå¼€å§‹çš„æ—¶å€™å°±ä¼šæ‰§è¡Œä¸€æ¬¡æµ‹è¯•ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1771371-0a82b1612b42f11c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åˆšå¼€å§‹çš„æµ‹è¯•ç»“æœ"></p>
<p>å…¶ä¸­ï¼Œ<code>Test score #0</code> æ˜¯å‡†ç¡®åº¦ï¼ˆaccuracyï¼‰ï¼Œ<code>Test score #1</code> æ˜¯æŸå¤±å‡½æ•°ï¼ˆlossï¼‰ã€‚å¯è§ï¼Œåˆšå¼€å§‹çš„æ—¶å€™å‡†ç¡®åº¦è¾ƒä½ã€æŸå¤±è¾ƒå¤§ã€‚</p>
<p>æ ¹æ®è®¾ç½®ï¼Œæ¯è¿­ä»£ 500 æ¬¡åä¼šæµ‹è¯•ä¸€æ¬¡ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1771371-ccd1f6cffac4bfbb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¿­ä»£ 500 æ¬¡åçš„æµ‹è¯•ç»“æœ"></p>
<p>è¿™ä¸€æ¬¡å‡†ç¡®åº¦æ‰“åˆ°äº† 0.974ï¼Œæé«˜äº†ä¸å°‘ï¼ŒæŸå¤±å‡½æ•°ä¹Ÿé™åˆ°æ¯”è¾ƒå°äº†ã€‚è¿­ä»£ 1000 æ¬¡åä¼šä¿å­˜ä¸€æ¬¡å¿«ç…§ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1771371-2abe97c3547a344a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¿­ä»£ 1000 æ¬¡åä¼šä¿å­˜ä¸€æ¬¡å¿«ç…§"></p>
<p>å…¶ä¸­ï¼Œ<code>finetune_voc_2007_trainval_iter_1000</code> å°±æ˜¯è¿­ä»£ 1000 æ¬¡çš„ Caffe æ¨¡å‹ï¼Œ<code>finetune_voc_2007_trainval_iter_1000.solverstate</code> æ˜¯ä¿å­˜çš„ solver çŠ¶æ€ï¼Œä½¿ç”¨æ­¤æ–‡ä»¶å¯ä»¥æ¢å¤ä¸­æ–­çš„è®­ç»ƒã€‚</p>
<p>èŠ±è´¹äº†æ¥è¿‘ 12 ä¸ªå°æ—¶ï¼Œ2 ä¸‡æ¬¡è¿­ä»£çš„è®­ç»ƒç»ˆäºå®Œæˆäº†ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1771371-0a465ddf4df729e8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è®­ç»ƒå®Œæˆ"></p>
<p>åœ¨å½“å‰ç›®å½•ï¼ˆ<code>rcnn/external/caffe/examples/pascal-finetuning</code>ï¼‰ä¸‹ç”Ÿæˆäº†ä¸€ç³»åˆ— <code>finetune_voc_2007_trainval_iter_*</code> å’Œ <code>finetune_voc_2007_trainval_iter_*.solverstate</code> æ–‡ä»¶ï¼Œè¿™äº›å°±æ˜¯æ¯è¿­ä»£ 1000 æ¬¡ä¿å­˜çš„å¿«ç…§ï¼Œå…¶ä¸­ <code>finetune_voc_2007_trainval_iter_20000</code> å°±æ˜¯æœ€ç»ˆçš„æ¨¡å‹äº†ã€‚</p>
<p>å°†æ­¤æ¨¡å‹æ›´åä¸º <code>finetune_voc_2007_trainval_iter_70k</code>ï¼Œç§»èµ° <code>rcnn/data/caffe_nets</code> ä¸‹çš„åŒåæ–‡ä»¶ï¼Œå°†æ¨¡å‹å¤åˆ¶åˆ°æ­¤ç›®å½•ä¸‹ï¼Œåç»­çš„æå–ç‰¹å¾ç­‰æ“ä½œç”¨çš„å°±æ˜¯è¿™ä¸ªæ¨¡å‹äº†ã€‚</p>
<h3 id="ç»˜åˆ¶è®­ç»ƒæ›²çº¿å›¾"><a href="#ç»˜åˆ¶è®­ç»ƒæ›²çº¿å›¾" class="headerlink" title="ç»˜åˆ¶è®­ç»ƒæ›²çº¿å›¾"></a>ç»˜åˆ¶è®­ç»ƒæ›²çº¿å›¾</h3><p>Caffe æä¾›æœ‰ä¸€äº›å·¥å…·ï¼Œå¯ä»¥å°†è®­ç»ƒè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸€äº›æ•°æ®ç»˜åˆ¶æˆæ›²çº¿å›¾ã€‚</p>
<p>è®­ç»ƒè¿‡ç¨‹çš„è¾“å‡ºå…¨éƒ¨ä¿å­˜åœ¨å½“å‰ç›®å½•çš„ <code>log.txt</code> æ–‡ä»¶ä¸­ï¼Œå°†æ­¤æ–‡ä»¶å¤åˆ¶åˆ° <code>rcnn/external/caffe/tools/extra</code> ä¸­ï¼Œä½¿ç”¨ cd å‘½ä»¤è¿›å…¥æ­¤æ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./parse_log.sh log.txt</span><br></pre></td></tr></table></figure>
<p>åœ¨æ­¤æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆäº† <code>log.txt.train</code> å’Œ <code>log.txt.test</code> ä¸¤ä¸ªæ–‡ä»¶ï¼Œå‰è€…æ˜¯è®­ç»ƒäº§ç”Ÿçš„æ•°æ®ï¼Œåè€…æ˜¯æµ‹è¯•äº§ç”Ÿçš„æ•°æ®ã€‚å†æ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./plot_training_log.py.example &lt;æ›²çº¿ç±»å‹å‚æ•°&gt; &lt;å›¾ç‰‡æ–‡ä»¶å&gt;.png log.txt</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œæ›²çº¿ç±»å‹æ”¯æŒä»¥ä¸‹å…«ç§ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">å‚æ•°</th>
<th style="text-align:center">æ›²çº¿ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">Test accuracy  vs. Iters</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">Test accuracy  vs. Seconds</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">Test loss  vs. Iters</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">Test loss  vs. Seconds</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">Train learning rate  vs. Iters</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">Train learning rate  vs. Seconds</td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center">Train loss  vs. Iters</td>
</tr>
<tr>
<td style="text-align:center">7</td>
<td style="text-align:center">Train loss  vs. Seconds</td>
</tr>
</tbody>
</table>
</div>
<p>ä¾‹å¦‚ï¼Œæˆ‘è¦ç»˜åˆ¶æµ‹è¯•å‡†ç¡®åº¦éšè¿­ä»£æ¬¡æ•°å˜åŒ–çš„æ›²çº¿å›¾ï¼ˆå‚æ•°ä¸º <code>0</code>ï¼‰ï¼Œå¹¶å°†å›¾ç‰‡ä¿å­˜ä¸º <code>test_accuracy_vs_iters.png</code>ï¼Œæ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./plot_training_log.py.example 0 test_accuracy_vs_iters.png log.txt</span><br></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºç»˜åˆ¶ç»“æœï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1771371-b7c47dabf973c30a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å‡†ç¡®åº¦éšè¿­ä»£æ¬¡æ•°å˜åŒ–çš„æ›²çº¿å›¾"></p>
<p>åŒæ—¶ï¼Œå›¾ç‰‡ä¼šä»¥æŒ‡å®šçš„æ–‡ä»¶åä¿å­˜åœ¨å½“å‰ç›®å½•ã€‚</p>
<h2 id="æå–ç‰¹å¾"><a href="#æå–ç‰¹å¾" class="headerlink" title="æå–ç‰¹å¾"></a>æå–ç‰¹å¾</h2><p>æ‰“å¼€ MATLABï¼Œåœ¨ <code>rcnn</code> ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æå–ç‰¹å¾ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; rcnn_exp_cache_features(&apos;train&apos;);</span><br><span class="line">&gt;&gt; rcnn_exp_cache_features(&apos;val&apos;);</span><br><span class="line">&gt;&gt; rcnn_exp_cache_features(&apos;test_1&apos;);</span><br><span class="line">&gt;&gt; rcnn_exp_cache_features(&apos;test_2&apos;);</span><br></pre></td></tr></table></figure>
<p>è¿™å››ä¸ªå‡½æ•°åˆ†åˆ«å°† <code>train</code>ã€<code>val</code>ã€<code>test</code>ï¼ˆå‰åŠéƒ¨åˆ† <code>test_1</code>ï¼ŒååŠéƒ¨åˆ† <code>test_2</code>ï¼‰æ•°æ®é›†ä¸­å›¾ç‰‡çš„å€™é€‰åŒºåŸŸé€šè¿‡ç¥ç»ç½‘ç»œï¼Œç„¶åæå–å‡º <code>pool5</code> å±‚çš„ç‰¹å¾ï¼Œä»¥ <code>.mat</code> å½¢å¼å­˜å‚¨åœ¨ <code>rcnn/feat_cache/v1_finetune_voc_2007_trainval_iter_70k/voc_2007_*</code> ä¸­ã€‚</p>
<div class="note info">
            <p>è¿™ä¸€æ­¥éœ€è¦è¾ƒé•¿çš„æ—¶é—´å’Œè¾ƒå¤šçš„å­˜å‚¨ç©ºé—´ï¼Œæå– 1000 å¼ å›¾ç‰‡çš„ç‰¹å¾èŠ±äº† 12 ä¸ªå°æ—¶å¤šï¼Œå äº† 7 ä¸ªå¤š G çš„ç£ç›˜ç©ºé—´ã€‚å¦‚æœ Ubuntu åˆ†åŒºçš„ç£ç›˜ç©ºé—´ä¸å¤Ÿçš„è¯ï¼Œå¯ä»¥æŠŠ <code>rcnn/feat_cache</code> é“¾æ¥åˆ°å…¶ä»–åˆ†åŒºä¸Šã€‚å¦å¤–ï¼Œå¯ä»¥å†™ä¸€ä¸ª MATLAB è„šæœ¬æ¥è¿ç»­æ‰§è¡Œè¿™å››ä¸ªå‡½æ•°ï¼Œç„¶åå°±ä¸ç®¡ç”µè„‘äº†ã€‚</p>
          </div>
<h2 id="è®­ç»ƒä¸æµ‹è¯•"><a href="#è®­ç»ƒä¸æµ‹è¯•" class="headerlink" title="è®­ç»ƒä¸æµ‹è¯•"></a>è®­ç»ƒä¸æµ‹è¯•</h2><p>åœ¨ <code>rcnn</code> ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œè®­ç»ƒä¸æµ‹è¯•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; test_results = rcnn_exp_train_and_test()</span><br></pre></td></tr></table></figure>
<p>æ€»å…±èŠ±è´¹äº†å‡ ååˆ†é’Ÿçš„æ—¶é—´å§ã€‚</p>
<p>åœ¨æµ‹è¯•ç»“æŸæ—¶ï¼Œç¨‹åºç»˜åˆ¶å‡ºå‡†ç¡®ç‡/å¬å›ç‡ï¼ˆprecision/recallï¼‰æ›²çº¿ï¼ˆå…³äºå‡†ç¡®ç‡å’Œå¬å›ç‡ï¼Œçœ‹<a href="http://blog.sina.com.cn/s/blog_4b59de070100ehl7.html" target="_blank" rel="noopener">è¿™é‡Œ</a>ï¼‰å’Œå¹³å‡ç²¾åº¦ï¼ˆaverage precisionï¼ŒAPï¼‰ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1771371-710539bed53db8d4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¯¹æ£€æµ‹çš„è¯„ä¼°"></p>
<p>è¿™å¼ å›¾ç‰‡ä¿å­˜åœ¨ <code>rcnn/cachedir/voc_2007_test</code> ä¸‹ï¼Œæ–‡ä»¶åä¸º <code>face_pr_voc_2007_test.jpg</code>ã€‚</p>
<p>æœ€ç»ˆï¼ŒCommand Window è¾“å‡ºæµ‹è¯•ç»“æœï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1771371-2fa6c4b2e0f244bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æµ‹è¯•ç»“æœ"></p>
<p>ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡ä¸ºå¬å›ç‡ï¼ˆ<code>recall</code>ï¼‰ã€å‡†ç¡®ç‡ï¼ˆ<code>prec</code>ï¼‰ã€å¹³å‡ç²¾åº¦ï¼ˆ<code>ap</code>ï¼‰ï¼Œæœ€åä¸€ä¸ª <code>ap_auc</code> æˆ‘ä¹Ÿä¸æ¸…æ¥šæ˜¯ä»€ä¹ˆ ğŸ˜‘ã€‚</p>
<h1 id="æµ‹è¯•æ¨¡å‹"><a href="#æµ‹è¯•æ¨¡å‹" class="headerlink" title="æµ‹è¯•æ¨¡å‹"></a>æµ‹è¯•æ¨¡å‹</h1><p>ç»è¿‡è®­ç»ƒï¼ŒR-CNN æ¨¡å‹ <code>rcnn_model.mat</code> å°±å·²ç»ç”Ÿæˆäº†ï¼Œå‚¨å­˜åœ¨ <code>rcnn/cachedir/voc_2007_trainval</code> ä¸­ã€‚è¿™ä¸ªæ¨¡å‹æ–‡ä»¶å°±å¯ä»¥ç”¨æ¥å¯¹è‡ªå·±çš„å›¾ç‰‡è¿›è¡Œæ£€æµ‹äº†ã€‚</p>
<p>å¯¹ä½œè€…æä¾›çš„ <code>rcnn_demo.m</code>ï¼ˆåœ¨ <code>rcnn/examples</code> é‡Œï¼‰ç¨ä½œä¿®æ”¹ï¼Œç”Ÿæˆä¸€ä¸ªæ–°å‡½æ•° <code>test_my_detector</code>ï¼Œæ­¤å‡½æ•°èƒ½ä½¿ç”¨åˆšæ‰è®­ç»ƒå¥½çš„æ¨¡å‹ <code>rcnn_model.mat</code> æ£€æµ‹å›¾ç‰‡ä¸­çš„äººè„¸ï¼š</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test_my_detector</span><span class="params">(im_path)</span></span></span><br><span class="line"></span><br><span class="line">clf;</span><br><span class="line"></span><br><span class="line">thresh = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ~exist(<span class="string">'im_path'</span>, <span class="string">'var'</span>) || <span class="built_in">isempty</span>(im_path)</span><br><span class="line">  im_path = input(<span class="string">'Please input the path of an image:\n'</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">im = imread(im_path);</span><br><span class="line"></span><br><span class="line">rcnn_model_file = <span class="string">'./cachedir/voc_2007_trainval/rcnn_model.mat'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ~exist(rcnn_model_file, <span class="string">'file'</span>)</span><br><span class="line">  error(<span class="string">'You need to train a R-CNN model first.'</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% Initialization only needs to happen once (so this time isn't counted when timing detection).</span></span><br><span class="line">fprintf(<span class="string">'Initializing R-CNN model (this might take a little while)\n'</span>);</span><br><span class="line">rcnn_model = rcnn_load_model(rcnn_model_file, <span class="built_in">true</span>);</span><br><span class="line">fprintf(<span class="string">'done\n'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">% Get current timestamp</span></span><br><span class="line">th = tic;</span><br><span class="line">dets = rcnn_detect(im, rcnn_model, thresh);</span><br><span class="line">fprintf(<span class="string">'Total %d-class detection time: %.3fs\n'</span>, <span class="built_in">length</span>(rcnn_model.classes), toc(th));</span><br><span class="line"></span><br><span class="line">all_dets = [];</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span>:<span class="built_in">length</span>(dets)</span><br><span class="line">  all_dets = <span class="built_in">cat</span>(<span class="number">1</span>, all_dets, [<span class="built_in">i</span> * <span class="built_in">ones</span>(<span class="built_in">size</span>(dets&#123;<span class="built_in">i</span>&#125;, <span class="number">1</span>), <span class="number">1</span>) dets&#123;<span class="built_in">i</span>&#125;]);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">[~, ord] = <span class="built_in">sort</span>(all_dets(:,<span class="keyword">end</span>), <span class="string">'descend'</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span>:<span class="built_in">length</span>(ord)</span><br><span class="line">  score = all_dets(ord(<span class="built_in">i</span>), <span class="keyword">end</span>);</span><br><span class="line">  <span class="keyword">if</span> score &lt; <span class="number">0</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  cls = rcnn_model.classes&#123;all_dets(ord(<span class="built_in">i</span>), <span class="number">1</span>)&#125;;</span><br><span class="line">  showboxes(im, all_dets(ord(<span class="built_in">i</span>), <span class="number">2</span>:<span class="number">5</span>));</span><br><span class="line">  title(sprintf(<span class="string">'det #%d: %s score = %.3f'</span>, <span class="built_in">i</span>, cls, score));</span><br><span class="line">  drawnow;</span><br><span class="line">  pause;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">fprintf(<span class="string">'No more detection with score &gt;= 0\n'</span>);</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>rcnn</code> ç›®å½•ä¸‹è°ƒç”¨æ­¤å‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; test_my_detector(&apos;&lt;å›¾ç‰‡è·¯å¾„&gt;&apos;)</span><br></pre></td></tr></table></figure>
<p>æ£€æµ‹äº†ä¸€å¼ æˆ‘å¼Ÿçš„ç…§ç‰‡ï¼ˆæœªæˆå¹´äººï¼Œè„¸éƒ¨åæœŸåšäº†å±è”½å¤„ç†ï¼‰ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1771371-516e91f945b4f959.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ£€æµ‹ç»“æœ"></p>
<p>ä¹‹ååˆé™†é™†ç»­ç»­æµ‹è¯•äº†å‡ å¼ å›¾ç‰‡ï¼Œå‘ç°æœ‰äº›ä¸å¤ªæ¸…æ¥šçš„äººè„¸è¿˜æ˜¯è¯†åˆ«ä¸å‡ºæ¥ï¼Œå½“ç„¶ï¼Œæ£€æµ‹çš„è¿‡ç¨‹è¿˜å¾ˆæ…¢ï¼ˆå¤§æ¦‚å‡ åç§’çš„æ ·å­ï¼‰ï¼Œä¸è¿‡è¿™æ˜¯ R-CNN çš„ç¡¬ä¼¤äº†ï¼Œæƒ³è¦æ›´å¿«çš„ï¼Ÿå»æ‰¾ <a href="https://github.com/rbgirshick/fast-rcnn" target="_blank" rel="noopener">Fast R-CNN</a> å’Œ <a href="https://github.com/rbgirshick/py-faster-rcnn" target="_blank" rel="noopener">Faster R-CNN</a> å§ã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><a href="http://blog.csdn.net/happyxieqiang/article/details/51356722" target="_blank" rel="noopener">ç”¨è‡ªå·±çš„æ•°æ®è®­ç»ƒFaster-RCNN - åƒèœ—ç‰›ä¸€æ ·ï¼Œæ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ - CSDNåšå®¢</a></li>
<li><a href="https://github.com/rbgirshick/rcnn/issues/42" target="_blank" rel="noopener">Problems training on my own dataset Â· Issue #42 Â· rbgirshick/rcnn</a></li>
<li><a href="http://blog.csdn.net/u013078356/article/details/51154847" target="_blank" rel="noopener">caffeç»˜åˆ¶è®­ç»ƒè¿‡ç¨‹çš„losså’Œaccuracyæ›²çº¿ - é‚¬å°é˜³ - CSDNåšå®¢</a></li>
</ul>
<h1 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h1><p>è‡ªå·±ä»¥å‰å¯¹æœºå™¨å­¦ä¹ çš„æ–¹å‘æ ¹æœ¬æ²¡ä»€ä¹ˆäº†è§£ï¼Œç„¶è€Œæ¯•ä¸šè®¾è®¡å´é€‰äº†ä¸ªè·Ÿ R-CNN æœ‰å…³çš„è¯¾é¢˜ï¼Œè‡³äºä¸ºä»€ä¹ˆè¦é€‰è¿™ä¸ªå‘çˆ¹çš„è¯¾é¢˜ï¼Œæˆ‘çœŸæ˜¯ä¸€è¨€éš¾å°½ï¼Œæ­¤å¤„å°±ä¸æäº†å§ã€‚æˆ‘åœ¨åšè¿™ä¸ªè¯¾é¢˜çš„è¿‡ç¨‹ä¸­ï¼Œå´æ˜¯æ”¶è·é¢‡ä¸°ï¼Œç„¶è€Œä¸€ç›´æ‹…å¿ƒè‡ªå·±æœ€ååšä¸å‡ºæ¥ï¼Œä½†æ˜¯ç»“æœå‡ºæ¥çš„é‚£ä¸€åˆ»ï¼Œä¸€åˆ‡ç–‘è™‘éƒ½çƒŸæ¶ˆäº‘æ•£ï¼Œæ¿€åŠ¨çš„å¿ƒæƒ…éš¾ä»¥è¨€è¡¨å•Šï¼Œæ„Ÿå¹è‡ªå·±è¿™ä¸€ä¸ªå¤šæœˆçš„æ—¶é—´çœŸçš„æ²¡ç™½è´¹ã€‚</p>

    </div>

    
    
    
        
      

      <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/post/rcnn-installation-memo.html" rel="next" title="R-CNN å®‰è£…è®°å½•">
                  <i class="fa fa-chevron-left"></i> R-CNN å®‰è£…è®°å½•
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/post/using-dlib-in-matlab.html" rel="prev" title="åœ¨ MATLAB ä¸­ä½¿ç”¨ Dlib">
                  åœ¨ MATLAB ä¸­ä½¿ç”¨ Dlib <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#æ„å»ºæ•°æ®é›†"><span class="nav-number">1.</span> <span class="nav-text">æ„å»ºæ•°æ®é›†</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¸‹è½½æ•°æ®é›†"><span class="nav-number">1.1.</span> <span class="nav-text">ä¸‹è½½æ•°æ®é›†</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è½¬æ¢æ•°æ®é›†"><span class="nav-number">1.2.</span> <span class="nav-text">è½¬æ¢æ•°æ®é›†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æ•°æ®é›†ç»“æ„"><span class="nav-number">1.2.1.</span> <span class="nav-text">æ•°æ®é›†ç»“æ„</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å‡†å¤‡å›¾ç‰‡"><span class="nav-number">1.2.2.</span> <span class="nav-text">å‡†å¤‡å›¾ç‰‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å‡†å¤‡æ ‡æ³¨æ–‡ä»¶"><span class="nav-number">1.2.3.</span> <span class="nav-text">å‡†å¤‡æ ‡æ³¨æ–‡ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å‡†å¤‡æ•°æ®é›†é…ç½®æ–‡ä»¶"><span class="nav-number">1.2.4.</span> <span class="nav-text">å‡†å¤‡æ•°æ®é›†é…ç½®æ–‡ä»¶</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¿®æ”¹ç›¸å…³ä»£ç "><span class="nav-number">1.3.</span> <span class="nav-text">ä¿®æ”¹ç›¸å…³ä»£ç </span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#è®­ç»ƒæ¨¡å‹"><span class="nav-number">2.</span> <span class="nav-text">è®­ç»ƒæ¨¡å‹</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#è®¡ç®—å€™é€‰åŒºåŸŸ"><span class="nav-number">2.1.</span> <span class="nav-text">è®¡ç®—å€™é€‰åŒºåŸŸ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è°ƒä¼˜-CNN"><span class="nav-number">2.2.</span> <span class="nav-text">è°ƒä¼˜ CNN</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#åŠ è½½æ•°æ®é›†"><span class="nav-number">2.2.1.</span> <span class="nav-text">åŠ è½½æ•°æ®é›†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åˆ›å»º-Window-Files"><span class="nav-number">2.2.2.</span> <span class="nav-text">åˆ›å»º Window Files</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä½¿ç”¨-Caffe-è¿›è¡Œè°ƒä¼˜"><span class="nav-number">2.2.3.</span> <span class="nav-text">ä½¿ç”¨ Caffe è¿›è¡Œè°ƒä¼˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç»˜åˆ¶è®­ç»ƒæ›²çº¿å›¾"><span class="nav-number">2.2.4.</span> <span class="nav-text">ç»˜åˆ¶è®­ç»ƒæ›²çº¿å›¾</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æå–ç‰¹å¾"><span class="nav-number">2.3.</span> <span class="nav-text">æå–ç‰¹å¾</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è®­ç»ƒä¸æµ‹è¯•"><span class="nav-number">2.4.</span> <span class="nav-text">è®­ç»ƒä¸æµ‹è¯•</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#æµ‹è¯•æ¨¡å‹"><span class="nav-number">3.</span> <span class="nav-text">æµ‹è¯•æ¨¡å‹</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#å‚è€ƒèµ„æ–™"><span class="nav-number">4.</span> <span class="nav-text">å‚è€ƒèµ„æ–™</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#åè®°"><span class="nav-number">5.</span> <span class="nav-text">åè®°</span></a></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/avatar.jpg"
      alt="å…¨æ°æ˜¯ä¹Ÿ">
  <p class="site-author-name" itemprop="name">å…¨æ°æ˜¯ä¹Ÿ</p>
  <div class="site-description" itemprop="description">è§è¯</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
    
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="https://github.com/zacjact1568" title="GitHub &rarr; https://github.com/zacjact1568" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
      </span>
    
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="mailto:zxjue@outlook.com" title="E-Mail &rarr; mailto:zxjue@outlook.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
      </span>
    
  </div>
  <div class="cc-license motion-element" itemprop="license">
    
  
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  &copy; 2017 â€“ 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-code"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å…¨æ°æ˜¯ä¹Ÿ</span>
</div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js?v=3.1.0"></script>
<script src="/js/utils.js?v=7.4.1"></script>
<script src="/js/schemes/muse.js?v=7.4.1"></script>

<script src="/js/next-boot.js?v=7.4.1"></script>



  





















  

  

  

  

</body>
</html>
